<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractTensorBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tensorics-core</a> &gt; <a href="index.source.html" class="el_package">org.tensorics.core.tensor</a> &gt; <span class="el_source">AbstractTensorBuilder.java</span></div><h1>AbstractTensorBuilder.java</h1><pre class="source lang-java linenums">// @formatter:off
 /*******************************************************************************
 *
 * This file is part of tensorics.
 *
 * Copyright (c) 2008-2011, CERN. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 ******************************************************************************/
// @formatter:on

package org.tensorics.core.tensor;

import static com.google.common.base.Preconditions.checkNotNull;

import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

import org.tensorics.core.tensor.operations.TensorInternals;

import com.google.common.base.Preconditions;
import com.google.common.collect.ImmutableSet;

/**
 * @author kfuchsbe
 * @param &lt;V&gt; the type of the elements of the tensor to build
 */
public abstract class AbstractTensorBuilder&lt;V&gt; implements TensorBuilder&lt;V&gt; {

    private final Set&lt;Class&lt;?&gt;&gt; dimensions;
    private final VerificationCallback&lt;V&gt; callback;
<span class="fc" id="L44">    private Position context = Position.empty();</span>

<span class="fc" id="L46">    public AbstractTensorBuilder(Set&lt;Class&lt;?&gt;&gt; dimensions, VerificationCallback&lt;V&gt; callback) {</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">        Preconditions.checkArgument(dimensions != null, &quot;Argument '&quot; + &quot;dimensions&quot; + &quot;' must not be null!&quot;);</span>
<span class="pc bpc" id="L48" title="1 of 2 branches missed.">        Preconditions.checkArgument(callback != null, &quot;Argument '&quot; + &quot;callback&quot; + &quot;' must not be null!&quot;);</span>
<span class="fc" id="L49">        Coordinates.checkClassesRelations(dimensions);</span>
<span class="fc" id="L50">        this.dimensions = ImmutableSet.copyOf(dimensions);</span>
<span class="fc" id="L51">        this.callback = callback;</span>
<span class="fc" id="L52">    }</span>

    public AbstractTensorBuilder(Set&lt;Class&lt;?&gt;&gt; dimensions) {
<span class="fc" id="L55">        this(dimensions, new VerificationCallback&lt;V&gt;() {</span>

            @Override
            public void verify(V scalar) {
                /* Nothing to do */
<span class="fc" id="L60">            }</span>
        });
<span class="fc" id="L62">    }</span>

    @Override
    public final TensorBuilder&lt;V&gt; put(Position position, V value) {
<span class="fc" id="L66">        Preconditions.checkNotNull(value, &quot;value must not be null!&quot;);</span>
<span class="fc" id="L67">        Preconditions.checkNotNull(position, &quot;position must not be null&quot;);</span>
<span class="fc" id="L68">        Positions.assertConsistentDimensions(position, this.dimensions);</span>
<span class="fc" id="L69">        this.callback.verify(value);</span>
<span class="fc" id="L70">        this.putIt(position, value);</span>
<span class="fc" id="L71">        return this;</span>
    }

    protected abstract void putIt(Position position, V value);

    @Override
    public TensorBuilder&lt;V&gt; context(Position newContext) {
<span class="fc" id="L78">        Preconditions.checkNotNull(newContext, &quot;context must not be null&quot;);</span>
<span class="fc" id="L79">        checkIfContextValid(newContext);</span>
<span class="fc" id="L80">        this.context = newContext;</span>
<span class="fc" id="L81">        return this;</span>
    }

    @Override
    public TensorBuilder&lt;V&gt; context(Object... coordinates) {
<span class="nc" id="L86">        return context(Position.of(coordinates));</span>
    }



    private void checkIfContextValid(Position context2) {
<span class="fc bfc" id="L92" title="All 2 branches covered.">        for (Class&lt;?&gt; oneDimensionClass : context2.dimensionSet()) {</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">            if (dimensions.contains(oneDimensionClass)) {</span>
<span class="fc" id="L94">                throw new IllegalStateException(&quot;Inconsistent state: &quot; + oneDimensionClass</span>
                        + &quot; you are trying to put in to context is a BASE dimension of the tensor!&quot;);
            }
<span class="fc" id="L97">        }</span>
<span class="fc" id="L98">    }</span>

    @Override
    public TensorBuilder&lt;V&gt; putAll(Tensor&lt;V&gt; tensor) {
<span class="fc" id="L102">        this.putAll(Position.empty(), tensor);</span>
<span class="fc" id="L103">        return this;</span>
    }

    @Override
    public final TensorBuilder&lt;V&gt; putAll(Position position, Tensor&lt;V&gt; tensor) {
<span class="fc" id="L108">        checkNotNull(tensor, &quot;The tensor must not be null!&quot;);</span>
<span class="fc" id="L109">        putAll(position, TensorInternals.mapFrom(tensor));</span>
<span class="fc" id="L110">        return this;</span>
    }

    @Override
    public TensorBuilder&lt;V&gt; putAll(Map&lt;Position, V&gt; newEntries) {
<span class="fc" id="L115">        putAll(Position.empty(), newEntries);</span>
<span class="fc" id="L116">        return this;</span>
    }

    @Override
    public TensorBuilder&lt;V&gt; putAll(Set&lt;Map.Entry&lt;Position, V&gt;&gt; entries) {
<span class="nc" id="L121">        entries.forEach(this::put);</span>
<span class="nc" id="L122">        return this;</span>
    }


    @Override
    public TensorBuilder&lt;V&gt; putAll(Position position, Map&lt;Position, V&gt; map) {
<span class="fc" id="L128">        checkNotNull(map, &quot;The map must not be null!&quot;);</span>
<span class="fc" id="L129">        checkNotNull(position, &quot;The position must not be null!&quot;);</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">        for (Entry&lt;Position, V&gt; entry : map.entrySet()) {</span>
<span class="fc" id="L131">            put(Positions.union(position, entry.getKey()), entry.getValue());</span>
<span class="fc" id="L132">        }</span>
<span class="fc" id="L133">        return this;</span>
    }

    @Override
    public TensorBuilder&lt;V&gt; put(java.util.Map.Entry&lt;Position, V&gt; entry) {
<span class="fc" id="L138">        this.put(entry.getKey(), entry.getValue());</span>
<span class="fc" id="L139">        return this;</span>
    }

    public Set&lt;Class&lt;?&gt;&gt; dimensions() {
<span class="fc" id="L143">        return dimensions;</span>
    }

    public Position context() {
<span class="fc" id="L147">        return this.context;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>